# 네트워크 이론

- 네트워크의 분류

    **크기에 따른 분류**

    - LAN(Local Area Network)
        - 가까운 지역끼리 묶음
    - WAN(Wide Area Network)
        - 멀리 있는 지역을 한데 묶은 네트워크
        - LAN을 다시 하나로 묶은 것

    **연결 형태에 따른 분류**

    - Star 형
        - 중앙 장비에 모든 노드가 연결됨

            ex) 공유기

    - Mesh 형
        - 여러 노드들이 서로 그물처럼 연결됨
    - 혼합형
        - 실제 인터넷은 여러 형태를 혼합한 형태
- 네트워크 통신 방식
    - 유니 캐스트
        - 특정한 한 사용자와만 1:1로 통신

            ex) 한 명

    - 멀티 캐스트
        - 특정 다수와 1:N으로 통신

            ex) 한 분단

    - 브로드 캐스트
        - 네트워크에 있는 모든 대상과 통신

            ex) 전체

- 네트워크 프로토콜
    - 정의
        - 프로토콜은 일종의 약속, 양식
        - 네트워크에서 노드와 노드가 통신할 때 어떤 노드가 어느 노드에게 어떤 데이터를 어떻게 보내느지 작성하기 위한 양식
    - 종류
        - Ethernet 프로토콜(MAC 주소)
            - 가까운 곳과 연락
        - ICMP, IPv4, ARP(IP 주소)
            - 멀리 있는 곳과 연락
        - TCP, UDP(포트 번호)
            - 여러가지 프로그램으로 연락할 때

- 네트워크 계층 모델
    - TCP/IP 모델
        - 계층

            4계층 - 응용

            3계층 - 전송

            2계층 - 네트워크

            1계층 - 네트워크 인터페이스

    - OSI 7계층

    **공통점**

    - 계층적 네트워크 모델
    - 계층간 역할 정의

    **차이점**

    - 계층의 수 차이
    - TCP/IP는 프로토콜 기반, OSI는 역할 기반
    - TCP/IP는 데이터 전송기술 특화, OSI는 통신 전반에 대한 표준
- 네트워크를 통해 전달되는 데이터, 패킷
    - 패킷이란
        - 네트워크 상에서 전달되는 데이터를 통칭하는 말로 네트워크에서 전달하는 데이터의 형식화된 블록
        - 패킷은 제어 정보와 사용자 데이터로 이루어지며 사용자 데이터는 페이로드라고 함
        - 형태

            헤더 - 페이로드 - 풋터

    - 캡슐화 vs 디캡슐화
        - 캡슐화(인캡슐레이션)
            - 여러 프로토콜을 이용해서 최종적으로 보낼 때 패킷을 만드는 과정
            - 높은 계층에서 낮은 계층 순으로
        - 디캡슐화
            - 패킷을 받았을 때, 프로토콜들을 하나씩 확인하면서 데이터를 확인하는 과정
            - 낮은 계층에서 높은 계층 순으로 확인
    - PDU(Protocol Data Unit)

        → 각 레이어가 처리하는 데이터의 단위

        - 4계층의 PDU = 세그먼트
        - 3계층의 PDU = 패킷
        - 2계층의 PDU = 프레임
- 가까이 있는 컴퓨터끼리는 이렇게 데이터를 주고 받는다(2계층)
    - 2계층에서 하는 일
        - 2계층의 기능
            - 하나의 네트워크 대역 즉, 같은 네트워크 상에 존재하는 여러 장비들 중에서 어떤 장비가 어떤 장비에게 보내는 데이터를 전달
            - 오류제어, 흐름제어 수행
        - 2계층의 네트워크 크기
            - 2계층은 하나의 네트워크 대역 LAN에서만 통신할 때 사용
            - 다른 네트워크와 통신할 때는 항상 3계층의 도움이  필요
    - 2계층에서 사용하는 주소
        - 물리적인 주소
            - MAC 주소
    - 2계층의 프로토콜
        - Ethernet 프로토콜
            - LAN에서 통신할 때 사용
- 실제로 컴퓨터끼리는 IP주소를 사용해 데이터를 주고 받는다(3계층)
    - 3계층의 기능
        - 3계층에서 하는 일
            - 다른 네트워크 대역 즉, 멀리 떨어진 곳에 존재하는 네트워크까지 어떻게 데이터를 전달할지 제어하는 일을 담당
            - 발신에서 착신까지의 패킷의 경로를 제어
        - 3계층에서 쓰는 주소
            - IPv4주소: 현재 PC에 할당된 IP주소
            - 서브넷마스크: IP주소에 대한 네트워크의 대역을 규정하는 것
            - 게이트웨이 주소: 외부와 통신할 때 사용하는 네트워크의 출입구

            → IPv4와 서브넷마스크는 나를 구분하기 위함이고, 게이트웨이는 외부에 나가기 위해 어디로 가야하는지를 알려주는 역할

            → 위 3개가 되어야 인터넷이 된다.

    - 일반적인 IP 주소
        - Classful IP 주소 → 예전
            - 필드 단위로 구분
        - Classfulless IP 주소 → 현재
            - 낭비되지 않도록 아껴쓰는 Classless IP 주소
        - 사설 IP와 공인 IP → 현재
            - 실제 인터넷 상에서는 공인 IP로만 통신하고 외부 네트워크 대역에서는 사설 IP 대역이 보이지 않는다.

        - 특수한 IP주소
            - 0.0.0.0
                - 나머지 모든 IP
            - 127.0.0.1
                - 나 자신을 나타내는 주소
            - 게이트웨이 주소
                - 어딘가로 가려면 일단 여기로
                - 일반적으로 공유기 IP를 씀
                - 외부와 통신하기 위함임.
                - 게이트웨이 설정을 안하면 인터넷이 안됨.

                    (나가는 곳이 어딘지 모르기 때문)

    - 사설 IP로 서버 운영하는 방법(KBDS 공인ip에 9000번포트 붙은 사례)

        → 포트 포워딩 이용

        - 사설 IP도 서버 컴퓨터로 사용 가능
        - 회사에서 부여 받은 공인 IP를 219.214.33.125라고 가정
        - 세 대의 컴퓨터 192.168.0.2, 192.168.0.3, 192.168.0.4를 사용
        - 이 때 공유기가 219.214.33.125의 80번 포트로 들어오는 패킷을 192.168.0.3으로 보냄
        - 이렇게 하면 192.168.0.3 컴퓨터를 웹 서버 컴퓨터로 사용할 수 있음
        - 특정 포트로 들어오는 패킷을 내부 컴퓨터로 넘겨주는 것을 포트포워딩이라고 함
        - 집에서 [http://211.62.204.12:9200/](http://211.62.204.12:9200/)를 접속하지 못하는 이유는 공인ip:9200번 포트로 붙은 사설ip이기 때문임

- 통신하기 전 반드시 필요한 ARP 프로토콜(3계층)
    - ARP가 하는 일
        - ARP 프로토콜은 같은 네트워크 대역에서 통신을 하기 위해 필요한 MAC주소를 IP주소를 이용해서 알아오는 프로토콜
        - 같은 네트워크 대역에서 통신을 한다고 하더라도 데이터를 보내기 위해서는 7계층부터 캡슐화를 통해 데이터를 보내기 때문에 IP주소와 MAC주소가 모두 필요하다.

            이 때 IP주소는 알고 MAC주소는 모르더라도 ARP를 통해 통신이 가능

        - 보안상 중요함.(ARP 스푸핑)
    - 
- 멀리 있는 컴퓨터끼리는 이렇게 데이터를 주고 받는다 - IP 프로토콜 구조
    - IPv4프로토콜
        - IPv4가 하는 일
            - 네트워크 상에서 데이터를 교환하기 위한 프로토콜
            - 데이터가 정확하게 전달될 것을 보장하지 않는다.
    - ICMP(Internet Control Message Protocol) 프로토콜
        - 인터넷 제어 메시지 프로토콜
        - 네트워크 컴퓨터 위에서 돌아가는 운영체제에서 오류 메시지를 전송 받는 데 주로 쓰임
        - 프로토콜 구조의 Type과 Code를 통해 오류 메시지를 전송 받는다.
    - 라우팅 테이블
        - 어디로 보내야 하는지 설정되어 있는 라우팅 테이블
    - IPv4의 조각화
        - 조각화란
            - 큰 IP 패킷들이 적은 MTU(Maximum Transmission Unit)를 갖는 링크를 통하여 전송되려면 여러 개의 작은 패킷으로 쪼개어/조각화 되어 전송돼야 한다.
            - 즉, 목적지까지 패킷을 전달하는 과정에 통과하는 각 라우터마다 전송에 적합한 프레임으로 변환이 필요하다.
- 컴퓨터의 프로그램끼리는 이렇게 데이터를 주고 받는다(4계층)
    - 4계층  프로토콜
        - 4계층에서 하는 일
            - 전송 계층은 송신자의 프로세스와 수신자의 프로세스를 연결하는 통신 서비스를 제공
            - 전송 계층은 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어, 그리고 다중화와 같은 편리한 서비스를 제공
        - 4계층 프로토콜의 종류
            - TCP
            - UDP
    - 포트 번호
        - 특정 프로세스와 특정 프로세스가 통신을 하기 위해 사용
        - 하나의 포트는 하나의 프로세스만 사용 가능
        - 하나의 프로세스가 여러 개의 포트를 사용하는 것응ㄴ 가능
        - 일반적으로 웹 서비스는 80번 포트를 사용하지만 웹 서비스가 항상 80번 포트를 사용해야만 하는 것은 아니다.
        - Well-Known 포트

            → 전 세계적으로 유명한

            - FTP - 20, 21번
            - SSH - 22번
            - TELNET - 23번
            - DNS - 53번
            - DHCP - 67, 68번
            - TFTP - 69번
            - HTTP - 80번
            - HTTPS - 443번
        - Registered 포트

            → 조금 유명한

            - 오라클 DB 서버 - 1521번
            - MySQL 서버 - 3306번
            - MS 원격 데스크탑 - 3389번
        - Dynamic 포트

            → 일반 사용자들이 사용하는 포트

            - 49152번 ~ 65535번
- 비연결지향형 UDB 프로토콜
    - 전송 방식은 너무 단순해서 서비스의 신뢰성이 낮음
    - UDP 프로토콜을 사용하는 프로그램
        - DNS 서버
            - 도메인을 물으면 IP를 알려줌
        - tftp(trivial file transfer protocol) 서버
            - UDP로 파일을 공유함
        - RIP 프로토콜
            - 라우팅 정보를 공유
- 연결지향형  TCP 프로토콜
    - TCP 프로토콜
        - 전송 제어 프로토콜은 인터넷에 연결된 컴퓨터에서 실행되는 프로그램 간에 통신을 안정적으로, 순서대로, 에러없이 교환할 수 있게 한다.
    - TCP 플래그의 종류
        - 주 된 기능이 플래그로 나눠짐
        - U A P R S F
            - U: urgent 긴급 비트
            - **A: Acknowlegement 승인 비트**
            - P: Push 비트
                - 데이터를 계속 밀어 넣겠다.
            - **R: Reset 초기화 비트**
                - 문제 생길 때
            - **S: Sync 동기화 비트**
            - **F: Fin 종료 비트**
                - 연결을 끊을 때 사용
    - TCP를 이용한 통신과정
        - 연결 수립 과정(Eth IPv4 TCP 형태로 보냄)
            - TCP를 이용한 데이터 통신을 할 때 프로세스와  프로세스를 연결하기 위해 가장 먼저 수행되는 과정
                1. 클라이언트가 서버에게 요청 패킷을 보내고
                    - Flag: SYN
                    - S:100 A:0
                        - S는 랜덤
                        - A는 랜덤
                2. 서버가 클라이언트의 요청을 받아들이는 패킷을 보내고
                    - Flag: SYN + ACK
                    - S:2000, A:101
                        - S는 랜덤
                        - A는 S + 1
                3. 클라이언트는 이를 최종적으로 수락하는 패킷을 보낸다.
                    - Flag: ACK
                    - S:101 A:2001
                        - S는 전 A
                        - A는 S + 1

                → 위 3개의 과정을 3Way Handshake라고 부름.

        - 데이터 송수신 과정(Eth IPv4 TCP Data(100) 형태로 보냄)
            - TCP를 이용한 데이터 통신을 할 때 단순히 TCP 패킷만을 캡슐화해서 통신하는 것이 아닌 페이로드를 포함한 패킷을 주고 받을 때의 일정한 규칙
                1. 보낸 쪽에서 또 보낼 때는 SEQ번호와 ACK번호가 그대로(위 연결 수립과정의 3번을 이어서 진행)
                    - Flag: PSH + ACK
                    - S:101 A:2001
                2. 받는 쪽에서 SEQ번호는 받은 ACK 번호가 됨.
                    - Flag: PSH + ACK
                    - S:2001 A:201
                        - S는 전 A
                        - A는 S + 100(데이터 값)
                3. 받는 쪽에서 ACK 번호는 받은 SEQ번호 + 데이터 크기
                    - Flag: ACK
                    - S:201 A: 2501
                        - S는 전 A
                        - A는 S + 500(데이터 값)
                            - 서버가 클라이언트에게 500을 보내줌
    - TCP 상태전이도
- NAT와 포트포워딩
    - NAT(Network Address Translation)란
        - IP 패킷의 TCP/UDP 포트 숫자와 소스 및 목적지의 IP 주소 등을 재기록하면서 라우터를 통해 네트워크 트래픽을 주고 받는 기술
        - 패킷에 변화가 생기기 때문에 IP나 TCP/UDP의 체크섬도 다시 계산되어 재기록해야 함.
        - NAT를 이용하는 이유는 대게 사설 네트워크에 속한 여러 개의 호스트가 하나의 공인 IP 주소를 사용하여 인터넷에 접속하기 위함이다.
        - 하지만 꼭 사설 IP를 공인 IP로 변환 하는 데에만 사용하는 기술은 아니다.
    - 포트포워딩
        - 특정 IP 주소와 포트 번호의 통신 요청을 특정 다른 IP와 포트 번호로 넘겨주는 네트워크 주소 변환(NAT)의 응용
- 7계층 프로토콜 HTTP
    - HTTP(HyperText Transfer Protocol) 프로토콜

    - HTTP 요청 프로토콜의 구조
    - HTTP 응답 프로토콜의 구조

        → 서버가 알려주는 여러가지 정보

        - 100~199: 단순한 정보
        - **200~299: Client의 요청 성공**
        - 300~399: Client의 요청이 수행되지 않아 다른 URL로 재지정
        - **400~499: Client의 요청이 불완전하여 다른 정보가 필요**
            - 403: Forbidden - Client가 권한이 없는 페이지를 요청했을 때
            - 404: Not Found - Client가 서버에 없는 페이지를 요청했을 때
        - **500~599: Server의 오류를 만나거나 Client의 요청 수행 불가**
            - 500: Internal Server Error - Server의 일부가 멈췄거나 설정 오류가 발생
            - 503: Service Unavailable - 최대 Session 수를 초과했을 때